import { BotContext } from '../bot';
import { CONFIG } from '../config';
import { isPrivateChat } from '../utils/chat';

export const helpCommand = async (ctx: BotContext): Promise<void> => {
  try {
    const isAdmin = CONFIG.ADMINS.includes(ctx.from!.id);
    const isPrivate = isPrivateChat(ctx);
    
    let message = `ü§ñ <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º</b>\n\n`;
    
    message += `<b>üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n`;
    message += `/start - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–µ\n`;
    message += `/info - –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)\n`;
    message += `/join - –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∏–≥—Ä—É\n`;
    message += `/leave - –û—Ç–º–µ–Ω–∏—Ç—å —É—á–∞—Å—Ç–∏–µ\n`;
    message += `/stats - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n`;
    message += `/rating_info - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤\n`;
    message += `/payment_info - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ\n`;
    message += `/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n\n`;
    
    message += `<b>üéÆ –ö–Ω–æ–ø–∫–∏:</b>\n`;
    message += `‚öΩ –Ø –∏–≥—Ä–∞—é - –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∏–≥—Ä—É\n`;
    message += `‚ùå –ü–µ—Ä–µ–¥—É–º–∞–ª - –û—Ç–º–µ–Ω–∏—Ç—å —É—á–∞—Å—Ç–∏–µ\n`;
    message += `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä—ã\n`;
    message += `‚úÖ (–≥–∞–ª–æ—á–∫–∞) - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É\n\n`;
    
    if (isAdmin) {
      if (isPrivate) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —á–∞—Ç–µ
        message += `<b>üëë –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n`;
        message += `/teams - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã\n`;
        message += `/players - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤\n`;
        message += `/rate @username ¬±1 - –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥\n`;
        message += `/scheme &lt;self|captain|ts&gt; - –°—Ö–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞\n`;
        message += `/result A 5-3 B - –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞\n`;
        message += `/finish_game confirm - –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É –∏ —Å–±—Ä–æ—Å–∏—Ç—å —Å–µ—Å—Å–∏—é\n`;
        message += `/register username "–ò–º—è" skill - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–∞\n`;
        message += `/remove_from_game username - –£–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫–∞ –∏–∑ —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã\n`;
        message += `/add username - –î–æ–±–∞–≤–∏—Ç—å –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞\n`;
        message += `/add16 user1 user2... - –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –ø–æ username\n`;
        message += `/reset_week - –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é\n`;
        message += `/add_history - –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ—à–ª—ã—Ö –º–∞—Ç—á–µ–π\n`;
        message += `/init_week - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É –Ω–∞ –Ω–µ–¥–µ–ª—é\n`;
        message += `/confirm_player_payment username - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É\n`;
        message += `/payment_status - –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤\n\n`;
        message += `üîí <i>–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö</i>\n\n`;
      } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ AI –≤ –∫–∞–Ω–∞–ª–µ
        message += `<b>üëë –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã (–≤ –∫–∞–Ω–∞–ª–µ):</b>\n`;
      }
      message += `/ai –≤–æ–ø—Ä–æ—Å - –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å AI\n\n`;
    }
    
    message += `<b>üìä –°—Ö–µ–º—ã —Ä–µ–π—Ç–∏–Ω–≥–∞:</b>\n`;
    message += `‚Ä¢ <b>self</b> - —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ (1-5)\n`;
    message += `‚Ä¢ <b>ts</b> - TrueSkill —Å–∏—Å—Ç–µ–º–∞\n\n`;
    
    message += `<b>‚öΩ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</b>\n`;
    message += `1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ /start\n`;
    message += `2. –ù–∞–∂–º–∏—Ç–µ "–Ø –∏–≥—Ä–∞—é" –∏–ª–∏ /join\n`;
    message += `3. –ñ–¥–∏—Ç–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥ (16 –∏–≥—Ä–æ–∫–æ–≤)\n`;
    message += `4. –ü–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ—Å—Ç–∞–≤–∞—Ö\n\n`;
    
    // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
    const currentScheme = process.env.SCHEME || CONFIG.SCHEME;
    message += `–¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞: <b>${currentScheme}</b>`;
    
    await ctx.reply(message, { parse_mode: 'HTML' });
  } catch (error) {
    console.error('Error in help command:', error);
    await ctx.reply('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–ø—Ä–∞–≤–∫–∏.');
  }
};